<!DOCTYPE html>
<html lang="en">
<head>
<title>DOM, Browser, Event Loop</title>


	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="shower-ribbon/styles/screen-16x10.css">
	<style media="screen">
        .slide {
            padding-top: 70px;
        }

	</style>
</head>
<body class="shower list">
	<header class="caption">
        <h1>DOM, Browser, Event Loop</h1>
    </header>

	<section class="slide">
        <h2 class="shout">DOM</h2>
    </section>

	<section class="slide">
        <h2>Document Object Model</h2>
        <pre>
            <code>&lt;html&gt;</code>
            <code>    &lt;head&gt;</code>
            <code>        &lt;title&gt;Example&lt;/title&gt;</code>
            <code>    &lt;/head&gt;</code>
            <code>    &lt;body&gt;</code>
            <code>        &lt;p&gt;This is an example page&lt;/p&gt;</code>
            <code>        &lt;h1&gt;Example page&lt;/h1&gt;</code>
            <code>    &lt;/body&gt;</code>
            <code>&lt;/html&gt;</code>
        </pre>
    </section>

    <section class="slide">
        <h2>Document Object Model</h2>
        <center><img src="pictures/dom1.jpg" width="70%" alt=""></center>
    </section>

    <section class="slide">
        <h2>Отображение страницы</h2>
        <ul>
            <li>загрузка html ресурса</li>
            <li>лексический и синтаксический анализ</li>
            <li>построение DOM</li>
            <li>загрузка и обработка CSS</li>
            <li>построение CSSOM</li>
            <li>построение дерева отображения</li>
            <li>...</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Document Object Model</h2>
        <ul>
            <li>программный интерфейс к HTML (XML) документам</li>
            <li>представляет из себя группу узлов</li>
            <li>каждый узел имеет свойства и методы</li>
            <li>в браузере доступна для JavaScript</li>
        </ul>
    </section>

    <section class="slide">
        <h2>DOM, типы объектов</h2>
        <ul>
            <li><code>document</code> – корневой элемент</li>
            <li><code>element</code> – узел DOM</li>
            <li><code>NodeList</code> – коллекция из element</li>
            <li><code>HTMLCollection</code> – коллекция из element</li>
            <li><code>attribute</code> – ссылка на объект для работы с атрибутами</li>
            <li><code>namedNodeMap</code> – map из element</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Выбор элементов</h2>
        <div>Возвращают <mark>живые</mark> коллекции <code>NodeList</code></div>
        <ul>
            <li><code>document.getElementById</code></li>
            <li><code>document.getElementsByName</code></li>
            <li><code>document.getElementsByTagName</code></li>
            <li><code>document.getElementsByClassName</code></li>
        </ul>

        <div>Возвращают <mark>статические</mark> коллекции <code>NodeList</code></div>
        <ul>
            <li><code>document.querySelectorAll</code></li>
            <li><code>document.querySelector</code></li>
        </ul>
    </section>
    <section class="slide">
        <h2>В чем разница?</h2>
        <pre>
            <code><span class="comment">&lt;!-- было --&gt;</span></code>
            <code>&lt;section&gt;1&lt;section&gt;</code>
            <code>&lt;section&gt;2&lt;section&gt;</code>
            <code>&lt;section&gt;3&lt;section&gt;</code>
            <code>...</code>
            <code>var nodes = document.<mark>getElementsByTagName</mark>('section');</code>
            <code>console.log(nodes.length)<span class="comment">// ???</span></code>
        </pre>
        <a href="https://jsfiddle.net/tu9ben4g/">https://jsfiddle.net/tu9ben4g/</a>
    </section>
    <section class="slide">
        <h2>В чем разница?</h2>
        <pre>
            <code><span class="comment">&lt;!-- было --&gt;</span></code>
            <code>&lt;section&gt;1&lt;section&gt;</code>
            <code>&lt;section&gt;2&lt;section&gt;</code>
            <code>&lt;section&gt;3&lt;section&gt;</code>
            <code>...</code>
            <code>var nodes = document.<mark>querySelectorAll</mark>('section');</code>
            <code>console.log(nodes.length)<span class="comment">// ???</span></code>
        </pre>
        <a href="https://jsfiddle.net/thoc54v1/1/">https://jsfiddle.net/thoc54v1/1/</a>
    </section>

    <section class="slide">
        <h2>Навигация по узлам</h2>
        <ul>
            <li><code>parentNode</code></li>
            <li><code>childNodes</code></li>
            <li><code>firstChild, lastChild</code></li>
            <li><code>nextSibling, previousSibling</code></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Навигация по элементам</h2>
        <ul>
            <li><code><mark>parentNode</mark></code></li>
            <li><code>children</code></li>
            <li><code>firstElementChild, lastElementChild</code></li>
            <li><code>nextElementSibling, previousElementSibling</code></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Атрибуты</h2>
        <ul>
            <li><code>attributes</code></li>
            <li><code>getAttribute</code></li>
            <li><code>setAttribute</code></li>
            <li><code>img.src</code></li>
            <li><code>img.html<mark>For</mark></code></li>
            <li><code>img.<mark>class</mark>Name</code></li>
            <li>верблюжийРегистр</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Содержимое элементов</h2>
        <pre>
            <code>var foo = document.getElementById('paragraph1');</code>
            <code>var html = foo.innerHtml; <span class="comment">// текст с разметкой</span></code>
            <code>var text = foo.innerText; <span class="comment">// только текст</span></code>
            <code>var p = foo.outerText;<span class="comment">// текст с разметкой включая себя</span></code>
        </pre>
    </section>

    <section class="slide">
        <h2>Создание новых узлов</h2>
        <pre>
            <code>var img = document.create<mark>Element</mark>('img');</code>
            <code>img.src = 'http://url/image.jpg';</code>
            <code>var text = document.create<mark>TextNode</mark>('Some text');</code>
            <code><span class="comment">/* А как добавить на страницу? */</span></code>
        </pre>
    </section>

    <section class="slide">
        <h2>Добавление на страницу</h2>
        <ul>
            <li><code>appendChild</code></li>
            <li><code>insertBefore</code></li>
        </ul>
        <pre>
            <code>var div = document.createElement('div');</code>
            <code>div.innerText = 'Hello';</code>
            <code>var form = document.getElementById('form1');</code>
            <code>form.appendChild(div);</code>
            <code><span class="comment">/* div - живая ссылка */</span></code>
        </pre>
    </section>

    <section class="slide">
        <h2><code>insertBefore</code></h2>
        <pre>
            <code>var div = document.createElement('div');</code>
            <code>div.innerText = 'Hello';</code>
            <code>var form = document.getElementById('form1');</code>
            <code><mark href="http://document.body">document.body</mark>.insertBefore(div, <mark>form</mark>);</code>
        </pre>
    </section>

    <section class="slide">
        <h2>Удаление элементов</h2>
        <pre>
            <code>var <mark>form</mark> = document.getElementById('form1');</code>
            <code>var removedForm = document.body.removeChild(form);</code>
            <code><span class="comment">/* или */</span></code>
            <code>var <mark>removedForm</mark> = form.remove(); <span class="comment">// Не поддерживается в IE</span></code>
        </pre>
        <blockquote>Элемент не удаляется совсем, он исключается из DOM, но сохраняется в памяти до тех пор, пока на него существуют ссылки</blockquote>
    </section>

    <section class="slide">
        <h2>DocumentFragment</h2>
        <ul>
            <li><code>var fragment = document.createDocumentFragment();</code></li>
            <li>не имеет родительского элемента</li>
            <li>не имеет отражения в DOM документа</li>
            <li>частично поддерживает методы работы с дочерними элементами</li>
            <li><code>querySelector</code>, <code>querySelectorAll</code></li>
        </ul>
        <div><a href="https://codepen.io/denisz/pen/vWdajM">Пример</a></div>
    </section>

    <section class="slide">
        <h2>События</h2>
        <code>target.addEventListener(type, listener[, useCapture]);</code>
        <ul>
            <li><code>type</code> - тип события</li>
            <li><code>listener</code> - объект принимающий событие или функция обратного вызова</li>
            <li><code>useCapture</code> - захват события <code>true/false</code></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Совместимость</h2>
        <pre>
            <code>if (el.addEventListener) {<span class="comment"> // обычные браузеры</span></code>
            <code>    el.addEventListener('click', modifyText, false);</code>
            <code>} else if (el.attachEvent)  {<span class="comment"> // IE8-</span></code>
            <code>    el.attachEvent('onclick', modifyText);</code>
            <code>}</code>
            <code>function modifyText(<mark>event</mark>) {</code>
            <code>...</code>
            <code>}</code>
        </pre>
    </section>

    <section class="slide">
        <h2>Отписка от события</h2>
        <pre>
            <code>el.addEventListener('click', modifyText, false);</code>
            <code>function modifyText(event) {</code>
            <code>...</code>
            <code>}</code>
            <code>el.<mark>removeEventListener</mark>('click', modifyText, false);</code>
            <code>el.<mark>detachEvent</mark>('onclick', modifyText) <span class="comment">/* для IE8- */</span></code>
        </pre>
    </section>

    <section class="slide">
        <h2>Event Bubbling vs Event Capturing</h2>
        <pre>
            <code>&lt;div id="d1"&gt;</code>
            <code>  &lt;a href="/404" id="l1"&gt;Link&lt;/a&gt;</code>
            <code>&lt;/div&gt;</code>
        </pre>
    </section>
    <section class="slide">
        <h2>Event Bubbling vs Event Capturing</h2>
        <pre>
            <code>d<mark>**</mark>.getElementById('d1').addEventListener('click', () => {</code>
            <code>  alert('div');</code>
            <code>});</code>
            <code>d<mark>**</mark>.getElementById('l1')addEventListener('click', () => {</code>
            <code>  alert('link');</code>
            <code>});</code>
        </pre>
        <a href="https://jsfiddle.net/5ph6oys2/5/">https://jsfiddle.net/5ph6oys2/5/</a>
    </section>

    <section class="slide">
        <h2 class="shout">window</h2>
    </section>

    <section class="slide">
        <h2>Таймеры</h2>
        <pre>
            <code>var timerId = setTimeout(function(){...}, <mark>300</mark>);</code>
            <code>var intervalId = setInterval(function(){...}, <mark>1000</mark>);</code>
            <code>...</code>
            <code>clearTimeout(timerId);</code>
            <code>clearInterval(intervalId);</code>
        </pre>
    </section>

    <section class="slide">
        <h2>URL и история</h2>
        <ul>
            <li>Объект <code>Location</code>
                <ul>
                    <li><code>location.href</code></li>
                    <li><code>location.hash</code></li>
                    <li><code>location.origin</code></li>
                    <li><code>location.search</code></li>
                    <li><code>location.assign()</code></li>
                    <li><code>location.reload()</code></li>
                </ul>
            </li>
        </ul>
    </section>

    <section class="slide">
        <h2>URL и история</h2>
        <ul>
            <li>Объект <code>History</code>
                <ul>
                    <li><code>history.pushState()</code></li>
                    <li><code>history.replaceState()</code></li>
                    <li><code>history.back()</code></li>
                    <li><code>history.forward()</code></li>
                    <li><code>history.go()</code></li>
                </ul>
            </li>
        </ul>
    </section>

    <section class="slide">
        <h2><code href="http://history.pushState">history.pushState</code></h2>
        <pre>
            <code>var state = {data: someData};</code>
            <code>var title = 'My amazing page';</code>
            <code>var url = '/index.html';</code>
            <code>history.pushState(state, title, url);</code>
        </pre>
    </section>

    <section class="slide">
        <h2>Как слушать переходы?</h2>
        <div>Событие <code>popstate</code></div>
        <pre>
            <code><span class="comment">// подписываемся на событие</span></code>
            <code>window.addEventListener('popstate', function(){</code>
            <code>    console.log('url changed');</code>
            <code>});</code>
        </pre>
    </section>

    <section class="slide">
        <h2 class="shout">640k</h2>
    </section>

    <section class="slide">
        <h2 class="shout">WebStorage</h2>
    </section>

    <section class="slide">
        <h2><code>localStorage</code></h2>
        <ul>
            <li>"постоянное" хранилище</li>
            <li>хранит ключ => значение</li>
            <li>данные хранит в виде строк</li>
            <li>досутпный размер хранилища зависит от браузера</li>
        </ul>
    </section>

    <section class="slide">
        <h2><code>localStorage</code></h2>
        <pre>
            <code>var data = {</code>
            <code>    a: 1,</code>
            <code>    b: 'text'</code>
            <code>};</code>
            <code>localStorage.setItem("data", <mark>JSON.stringify</mark>(data));</code>
            <code><span class="comment">// {"a":1,"b":"text"}</span></code>
        </pre>
    </section>

    <section class="slide">
        <h2><code>localStorage</code></h2>
        <pre>
            <code>var data = localStorage.<mark>getItem</mark>('data');</code>
            <code><span class="comment">// {"a":1,"b":"text"}</span></code>
            <code>console.log(JSON.parse(data)); <span class="comment">// Object</span></code>
            <code>console.log(localStorage.data);<span class="comment">// ???</span></code>
            <code>&nbsp;</code>
            <code>localStorage.<mark>removeItem</mark>('data');</code>
        </pre>
    </section>

    <section class="slide">
        <h2><code>sessionStorage</code></h2>
        <ul>
            <li>"временное" хранилище</li>
            <li>данные хранятся до закрытия вкладки или браузера</li>
            <li>хранит ключ => значение</li>
            <li>данные хранит в виде строк</li>
            <li>досутпный размер хранилища зависит от браузера</li>
        </ul>
    </section>

    <section class="slide">
        <h2>localStorage / sessionStorage</h2>
        <p>ммм... Где искать?</p>
        <a href="https://jsfiddle.net/denisz/o40aty7z/3/">https://jsfiddle.net/denisz/o40aty7z/3/</a>
    </section>

    <section class="slide">
        <h2 class="shout">Cookies</h2>
    </section>

    <section class="slide">
        <h2><code>Cookies</code></h2>
        <br /><br />
        <blockquote>– небольшой фрагмент данных, отправленный веб-сервером и хранимый на компьютере пользователя.
            Веб-клиент всякий раз при попытке открыть страницу соответствующего сайта пересылает этот фрагмент данных веб-серверу в
        составе HTTP-запроса.</blockquote>
    </section>

    <section class="slide">
        <h2><code>Cookies</code></h2>
        <pre>
            <code>console.log(document.cookie);<span class="comment"> // String</span></code>
            <code><span class="comment">// key=value; key2=value2; mykey=myvalue2</span></code>
        </pre>
    </section>

    <section class="slide">
        <h2><code>Cookies</code></h2>
        <ul>
            <li>key=value</li>
            <li>path=/mypath</li>
            <li>domain=mysite.ua</li>
            <li>expires=Tue, 19 Jan 2055 03:14:07 GMT</li>
        </ul>
    </section>

    <section class="slide">
        <h2 class="shout">WTF???</h2>
        <a href="https://jsfiddle.net/denisz/apy6um8n/3/">https://jsfiddle.net/denisz/apy6um8n/3/</a>
    </section>



    <section class="slide">
        <h2 class="shout">Event Loop</h2>
    </section>

    <section class="slide">
        <h2>Event Loop</h2>
        <ul>
            <li>Stack – стек вызовов, синхронная часть</li>
            <li>Heap – куча, область памяти</li>
            <li>Queue – очередь, асинхронная часть</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Event Loop</h2>
        <img src="pictures/event-loop.png" height="80%" style="display: block; margin: 0 auto;" alt="">
    </section>

    <section class="slide">
        <h2>Event Loop</h2>
        <pre>
            <code>function foo() {</code>
            <code>  baz();</code>
            <code>}</code>
            <code>function baz() {</code>
            <code>  bar()</code>
            <code>}</code>
            <code>function bar() {</code>
            <code>  console.log('hello');</code>
            <code>}</code>
        </pre>
    </section>

    <section class="slide">
        <h2>Event Loop</h2>
        <img src="pictures/event-loop.gif" height="80%" style="display: block; margin: 0 auto;" alt="">
    </section>

    <section class="slide">
        <h2 class="shout">Examples</h2>
        <a href="https://jsfiddle.net/denisz/9tkerns5/1/">https://jsfiddle.net/denisz/9tkerns5/1/</a>
    </section>

    <section class="slide">
        <h2>requestAnimationFrame</h2>
        <blockquote>указывает браузеру на то, что вы хотите произвести анимацию, и просит его запланировать перерисовку на следующем кадре
        анимации. В качестве параметра метод получает функцию, которая будет вызвана перед перерисовкой.</blockquote>
    </section>

    <section class="slide">
        <h2>requestAnimationFrame</h2>
        <pre>
            <code>window.requestAnimationFrame(() => console.log('hello'));</code>
        </pre>
        <ul>
            <li><a href="https://jsfiddle.net/denisz/n8p7gdtf/">https://jsfiddle.net/denisz/n8p7gdtf/</a></li>
            <li><a href="https://jsfiddle.net/denisz/n8p7gdtf/3/">https://jsfiddle.net/denisz/n8p7gdtf/3/</a></li>
            <li><a href="https://jsfiddle.net/denisz/n8p7gdtf/4/">https://jsfiddle.net/denisz/n8p7gdtf/4/</a></li>
            <li><a href="https://jsfiddle.net/denisz/n8p7gdtf/12/">https://jsfiddle.net/denisz/n8p7gdtf/12/</a></li>
        </ul>
    </section>

    <section class="slide">
        <h2>Самостоятельное изучение</h2>
        <ul>
            <li><a href="https://developer.mozilla.org/ru/docs/DOM/DOM_Reference">Руководство по DOM</a>,
            <a href="https://learn.javascript.ru/introduction-browser-events">Браузерные события</a></li>
            <li><a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Shadow_DOM">Shadow DOM</a>,
                <a href="https://learn.javascript.ru/shadow-dom">еще Shadow DOM</a>
                и <a href="http://w3c.github.io/webcomponents/spec/shadow/">спецификация</a>
            </li>
            <li><a href="https://www.youtube.com/watch?v=cCOL7MC4Pl0">Jake Archibald: In The Loop - JSConf.Asia 2018</a></li>
            <li><a href="https://habr.com/ru/company/ruvds/blog/337042/">Как работает JS: обзор движка, механизмов времени выполнения, стека вызовов</a></li>
            <li><a href="https://developer.mozilla.org/ru/docs/Web/API/Window/localStorage">LocaStorage</a> и
            <a href="https://developer.mozilla.org/ru/docs/Web/API/Window/sessionStorage">sessionStorage</a></li>

        </ul>
    </section>

    <section class="slide">
        <h2>Спасибо!</h2>
        <table class="simple-table">
            <tr>
                <td>
                    <p>
                        <strong>Denis Zavgorodny</strong>
                        <br /> web technologist, founder of @ChernivtsiJS,
                        <br />mentor at @NodeSchool Chernivtsi
                    </p>
                    <p>
                        <a href="https://twitter.com/DenisZavgorodny">@DenisZavgorodny</a>
                    </p>
                    <p>
                        <a href="mailto:denis.zavgorodny@gmail.com">denis.zavgorodny@gmail.com</a>
                    </p>
                </td>
            </tr>
        </table>
    </section>

	<div class="progress"></div>

	<script src="shower-core/shower.min.js"></script>
	<!-- Copyright © 2017 Yours Truly, Famous Inc. -->

</body>
</html>
